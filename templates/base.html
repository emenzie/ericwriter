<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EricWriter - {% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
</head>
<body class="{{ current_user.theme if current_user.is_authenticated else 'minimalist' }}">
    <nav>
        <div class="nav-content">
            <a href="/" class="logo" data-text="EricWriter">EricWriter</a>
            {% if current_user.is_authenticated %}
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
            {% endif %}
            <div class="nav-links">
                {% if current_user.is_authenticated %}
                    <div class="user-dropdown">
                        <button class="user-btn" onclick="toggleUserDropdown()">{{ current_user.username }}</button>
                        <div class="user-dropdown-menu" id="userDropdown">
                            <a href="/settings" class="dropdown-item">Settings</a>
                            <button onclick="logout()" class="dropdown-item logout-btn">Logout</button>
                        </div>
                    </div>
                {% else %}

                {% endif %}
            </div>
        </div>
    </nav>
    <main>
        {% block content %}{% endblock %}
    </main>
    {% if current_user.is_authenticated and current_user.theme == 'custom' %}
    <script>
    // Set custom theme variables from server
    const bgGradient = 'linear-gradient(0deg, {{ current_user.custom_bg_primary }} 0%, #ffffff 100%)';
    document.documentElement.style.setProperty('--custom-bg-primary', '{{ current_user.custom_bg_primary }}');
    document.documentElement.style.setProperty('--custom-bg-secondary', '{{ current_user.custom_bg_secondary }}');
    document.documentElement.style.setProperty('--custom-bg-gradient', bgGradient);
    document.documentElement.style.setProperty('--custom-text-primary', '{{ current_user.custom_text_primary }}');
    document.documentElement.style.setProperty('--custom-text-secondary', '{{ current_user.custom_text_secondary }}');
    document.documentElement.style.setProperty('--custom-accent-color', '{{ current_user.custom_accent_color }}');
    document.documentElement.style.setProperty('--custom-font-size-value', '{{ current_user.custom_font_size }}px');
    </script>
    {% endif %}
    <script>
    // Initialize theme from localStorage or server
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.body.className = savedTheme;
        }
    }
    
    // Mobile menu toggle
    function toggleMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        if (sidebar) {
            sidebar.classList.toggle('mobile-open');
        }
    }
    
    // User dropdown toggle
    function toggleUserDropdown() {
        const dropdown = document.getElementById('userDropdown');
        if (dropdown) {
            dropdown.classList.toggle('show');
        }
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('userDropdown');
        const userBtn = document.querySelector('.user-btn');
        if (dropdown && userBtn && !userBtn.contains(event.target) && !dropdown.contains(event.target)) {
            dropdown.classList.remove('show');
        }
    });
    
    window.addEventListener('load', initTheme);
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html> 